<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="shortcut icon" href="images/teams.ico" type="image/x-icon">
        <link rel="stylesheet" href="storage/css/settings.css">
        <title>Biología</title>

        <style>
            button {
                margin: 2px;
            }
        </style>

<script>
    if ('serviceWorker' in navigator) {
    window.addEventListener('load', function() {
        navigator.serviceWorker.register('/offline-worker.js').then(function(registration) {
            console.log('service worker initalised! scope:', registration.scope);

            navigator.serviceWorker.addEventListener('message', function(event) {
                if (event.data === 'cached') {
                    document.getElementById('cache-status').style.display = 'block';
                }
            });
        }, function(error) {
            console.log('ack, error with serviceworker! ', error);
        });
    });
}
</script>
        
  </head>
  <body>
        <div id="content-side">
            <h1>settings</h1>
            <a href="index.html" style="font-size: 18px;">go to homepage</a>

            <!--
            
            <br>
            <h2 style="margin: 0;">tab cloaking</h2>
            <br>
            <select id="presetSelect">
                <option value="google">google</option>
                <option value="googleclassroom">google classroom</option>
                <option value="googledrive">google drive</option>
                <option value="chrometab">chrome new tab</option>
                <option value="gmail">gmail</option>
                <option value="bing">bing</option>
                <option value="desmos">desmos calculator</option>
                <option value="wikipedia">wikipedia</option>
            </select>
        
            <button id="saveButton">select cloak</button>
            <button id="resetButton">reset cloak</button>
            <p id="success" style="display: none;">success message here</p>

            -->
            
            <br>
            <h2 style="margin: 0;">temas</h2>
            <br>
            <select id="theme-select">
                <option value="seraph">por defecto</option>
                <option value="azurite">azurite</option>
                <option value="retro">retro</option>
                <option value="cosmic">cosmic</option>
                <option value="molten">molten</option>
                <option value="amethyst">amethyst</option>
                <option value="ethereal">ethereal</option>
                <option value="subzero">subzero</option>
                <option value="metro">metro</option>
                <option value="ghostly">ghostly</option>
                <option value="custom">custom</option>
            </select>
        
            <button id="apply-theme">aplicar tema</button>
        
            <div id="custom-theme-settings" style="display: none;">
                <h2 style="text-decoration: underline;">personalización</h2>
                <div class="theme-property">
                    <label for="background-image">link para imagen de fondo:</label>
                    <input type="text" id="background-image" value="https://raw.githubusercontent.com/apuntes-biologia/seraph/main/images/backgrounds/seraph/homebg.png">
                </div>
        
                <div class="theme-property">
                    <label for="font-family">tipo de letra (fuente):</label>
                    <input type="text" id="font-family" value="Ubuntu">
                </div>
        
                <div class="theme-property">
                    <label for="text-color">color de texto:</label>
                    <input type="color" id="text-color" value="#000000">
                </div>
        
                <div class="theme-property">
                    <label for="background-color">color de fondo:</label>
                    <input type="color" id="background-color">
                </div>
        
                <div class="theme-property">
                    <label for="border-color1">color de borde:</label>
                    <input type="color" id="border-color1">
                </div>
        
                <div class="theme-property">
                    <label for="border-color2">color de borde secundario:</label>
                    <input type="color" id="border-color2">
                </div>
        
                <div class="theme-property">
                    <label for="hover-color">color al pasar ratón por encima:</label>
                    <input type="color" id="hover-color">
                </div>
        
                <div class="theme-property">
                    <label for="text-glow">color de glow del texto:</label>
                    <input type="color" id="text-glow">
                </div>
        
                <button id="apply-custom-theme" style="font-size: 18px;">aplicar ajustes</button>
                <br>
                <button id="import-theme" style="font-size: 18px; width: 120px;">importar</button>
                <button id="export-theme" style="font-size: 18px; width: 120px;">exportar</button>
            </div>

            <br>
            <h2 style="margin-bottom: 20px;">modo pánico</h2>
            <input type="text" id="panicKey" placeholder="elige una combinación de teclas" readonly>
            <input type="url" id="panicUrl" placeholder="https://google.com">
            <button onclick="saveSettings()">tecla(s) de pánico</button>
            <p id="success-panic" style="display: none;">tecla de pánico aplicada con éxito, refrescando página.</p>
            

            <br>
            <h2 style="margin-bottom: 20px;">gestión de datos</h2>
            <button onclick="importData()">importar datos</button>
            <button onclick="exportData()">exportar datos</button>
            <button onclick="clearData()">limpiar datos</button>

            <br>
            <h2 style="margin-bottom: 5px;">otros</h2>
            <p style="text-decoration: underline;">comportamiento de los links</p>
            <label>
                <input type="radio" name="openBlankSetting" value="true"> abrir links en nueva pestaña
            </label>
            <label>
                <input type="radio" name="openBlankSetting" value="false"> abrir links en la misma pestaña
            </label>

            <br>
            <br>
        
        <script src="storage/js/cloak.js"></script>
        <script src="storage/js/data.js"></script>
        <script src="/storage/js/settings.js"></script>
        <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

        <script>
            function RefStuff() {
                const urlParams = new URLSearchParams(window.location.search);
                const refid = localStorage.getItem('refID');

                if (!refid) {
                    window.location = `https://${window.location.hostname}/ca`;
                    return;
                };

                    $.ajax({
                        url: 'https://ts0880.es/registrar-visita-s',
                        method: 'GET',
                        data: {
                            ref: refid,
                            hostname: window.location.hostname
                        },
                        success: function(response) {
                            // Trim the response to remove any whitespace
                            response = response.trim();
                
                            // Check the response and take appropriate action
                            if (response === 'Falta algo') {
                                // Redirect to Google if ref is missing
                                window.location.href = `https://${getHostname}/ca`;
                            } else if (response === 'visita registrada OK') {
                                // If visit is registered successfully, do nothing (user can proceed)
                                console.log('Visit registered successfully');
                                localStorage.setItem('refID', getReferralParam());
                            } else if (/^\d/.test(response)) {
                                alert(`Tu cuenta ha sido suspendida el ${response}. Contacta con los administradores de la página para averiguar el motivo.`)
                            } else {
                                // Optional: Handle unexpected responses
                                console.log('Unexpected server response:', response);
                            }
                        },
                        error: function(xhr, status, error) {
                            // Optional: Handle request errors
                            console.error('Request failed:', status, error);
                            // You might want to add a fallback behavior here
                        }
                    });
                });
            }

            RefStuff();

            
        </script>
  </body>
</html>
